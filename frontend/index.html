<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeMorph</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Kaushan+Script&display=swap');
      #main-font {
        font-family: "Kaushan Script", cursive;
        font-weight: 400;
        font-style: normal;
      }
      .CodeMirror {
        border-radius: 0.75rem;
        border: 1px solid rgb(199 210 254); 
        margin: 0.75rem;
        flex: 1;
        min-height: 200px;
        font-size: 0.875rem;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen flex flex-col">
    <h1 class="text-4xl md:text-6xl text-center my-6 md:my-8 " id="main-font">CodeMorph</h1>
    <div class="flex flex-col md:flex-row flex-1 box-border p-4 border-2 border-indigo-300 m-4 md:m-7 shadow-xl shadow-indigo-500 rounded-xl gap-6">
      <div class="flex flex-col w-full md:w-1/2 mb-3">
        <div class="flex flex-col items-left bg-indigo-200 rounded-xl mb-2 w-34">
          <h2 class="font-bold mb-3 text-lg pl-2 pt-2">Program</h2>
        </div>
        <div class="box-border border border-indigo-200 w-full rounded-xl flex flex-col flex-1">
          <div class="flex justify-between items-center px-3 py-2 border-b border-indigo-100">
            <h3 class="font-bold">CODE</h3>
          </div>
          <textarea id="program-input" placeholder="Select and Enter your code"></textarea>
        </div>
        <p class="font-bold ml-2 mt-2">NOTE : Please ensure that target language is selected to get the output</p>
      </div>
      <div class="flex flex-col w-full md:w-1/2">
        <div class="mb-3 mt-12">
          <label for="language" class="block mb-1 font-bold text-gray-700">Target Language</label>
          <select id="language"
            class="w-full rounded-xl bg-indigo-200 border p-2 border-indigo-400 shadow-sm shadow-indigo-400">
            <option selected value="default">SELECT</option>
            <option value="Python">Python</option>
            <option value="C">C</option>
            <option value="Java">Java</option>
            <option value="C++">C++</option>
            <option value="C#">C#</option>
            <option value="Javascript">Javascript</option>
            <option value="Ruby">Ruby</option>
            <option value="Rust">Rust</option>
            <option value="Typescript">Typescript</option>
            <option value="Swift">Swift</option>
            <option value="Go">Go</option>
            <option value="R">R</option>
            <option value="Pearl">Pearl</option>
            <option value="Php">Php</option>
          </select>
        </div>
        <div class="box-border border border-indigo-200 w-full rounded-xl flex flex-col flex-1">
          <div class="flex justify-between items-center px-4 py-2 border-b border-indigo-100">
            <h3 class="font-bold">OUTPUT</h3>
            <button onclick="copyOutput()" class="px-2 py-1 text-xs bg-indigo-600 text-white rounded hover:bg-indigo-700">
              Copy
            </button>
          </div>
          <textarea id="outputBox" placeholder="Here is your output" 
            class="border rounded-xl m-3 flex-1 min-h-[200px] p-3 resize-none"></textarea>
        </div>
        <button id="convertBtn" onclick="convertCode()" class="mt-3 mb-11 w-full h-12 text-white font-semibold bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-full shadow-lg hover:scale-105 duration-200 hover:drop-shadow-2xl hover:shadow-[#7dd3fc] hover:cursor-pointer">
          Generate
        </button>
      </div>
    </div>
    <script>
      const programEditor = CodeMirror.fromTextArea(document.getElementById("program-input"), {
        lineNumbers: true,
        mode: "javascript",
        theme: "default"
      });
      function copyOutput() {
        const output = document.getElementById("outputBox");
        navigator.clipboard.writeText(output.value).then(() => {
          alert("Copied to clipboard!");
        });
      }

      async function convertCode() {
        const code = programEditor.getValue();
        const targetLanguage = document.getElementById("language").value;

        try {
          const response = await fetch("http://localhost:5000/convert", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ code, targetLanguage }),
          });

          if (!response.ok) {
            throw new Error("Server error!");
          }

          const data = await response.json();
          document.getElementById("outputBox").value = data.convertedCode;
        } catch (error) {
          document.getElementById("outputBox").innerText = `⚠️ ${error.message}`;
        }
      }

    </script>
  </body>
</html>
